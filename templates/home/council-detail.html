{% extends 'base.html' %} {% load static %} {% block css %}

<style>

  .model-btn:hover{
     cursor: pointer; 
  }

  .cnav-item {
    font-size: 15px;
  }

  h6 {
    font-size: 14px;
  }

  ::after,
  ::before {
    box-sizing: border-box;
  }


  .wrapper {
    max-width: 18rem;
    padding: 0 0.5rem;
  }

  .label {
    font-size: 0.75rem;
    font-weight: 400;
    display: block;
    color: #B0BEC5;
    border: 1px solid #ECEFF1;
    border-radius: 0.5rem;
    width: 195px;
    padding: 0px 0px 5px 5px;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #2A3547 !important;
  }

  .input {
    font-family: 'Roboto', sans-serif;
    display: block;
    border: none;
    border-radius: 0.25rem;
    border: 1px solid transparent;
    line-height: 1.5rem;
    padding: 0;
    font-size: 1rem;
    color: #607D8B;
    width: 100%;
    margin-top: 0.5rem;
  }

  .input:focus {
    outline: none;
  }

  #ui-datepicker-div {
    display: none;
    background-color: #fff;
    box-shadow: 0 0.125rem 0.5rem rgba(0, 0, 0, 0.1);
    border-radius: 0.5rem;
    padding: 0.5rem;
  }

  table {
    border-collapse: collapse;
    border-spacing: 0;
  }

  .ui-datepicker-calendar thead th {
    padding: 0;
    text-align: center;
    font-size: 0.75rem;
    font-weight: 400;
    color: #78909C;
  }

  .ui-datepicker-calendar tbody td {
    width: 2.5rem;
    text-align: center;
    padding: 0;
  }

  .ui-datepicker-calendar tbody td a {
    display: block;
    border-radius: 0.25rem;
    line-height: 2rem;
    transition: 0.3s all;
    color: #546E7A;
    font-size: 0.875rem;
    text-decoration: none;
  }

  .ui-datepicker-calendar tbody td a:hover {
    background-color: #E0F2F1;
  }

  .ui-datepicker-calendar tbody td a.ui-state-active {
    background-color: #009688;
    color: white;
  }

  .ui-datepicker-header a.ui-corner-all {
    cursor: pointer;
    position: absolute;
    top: 0;
    width: 2rem;
    height: 2rem;
    margin: 0.5rem;
    border-radius: 0.25rem;
    transition: 0.3s all;
  }

  .ui-datepicker-header a.ui-corner-all:hover {
    background-color: #ECEFF1;
  }

  .ui-datepicker-header a.ui-datepicker-prev {
    left: 0;
    background: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMyIgaGVpZ2h0PSIxMyIgdmlld0JveD0iMCAwIDEzIDEzIj48cGF0aCBmaWxsPSIjNDI0NzcwIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik03LjI4OCA2LjI5NkwzLjIwMiAyLjIxYS43MS43MSAwIDAgMSAuMDA3LS45OTljLjI4LS4yOC43MjUtLjI4Ljk5OS0uMDA3TDguODAzIDUuOGEuNjk1LjY5NSAwIDAgMSAuMjAyLjQ5Ni42OTUuNjk1IDAgMCAxLS4yMDIuNDk3bC00LjU5NSA0LjU5NWEuNzA0LjcwNCAwIDAgMS0xLS4wMDcuNzEuNzEgMCAwIDEtLjAwNi0uOTk5bDQuMDg2LTQuMDg2eiIvPjwvc3ZnPg==");
    background-repeat: no-repeat;
    background-size: 0.5rem;
    background-position: 50%;
    transform: rotate(180deg);
  }

  .ui-datepicker-header a.ui-datepicker-next {
    right: 0;
    background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMyIgaGVpZ2h0PSIxMyIgdmlld0JveD0iMCAwIDEzIDEzIj48cGF0aCBmaWxsPSIjNDI0NzcwIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik03LjI4OCA2LjI5NkwzLjIwMiAyLjIxYS43MS43MSAwIDAgMSAuMDA3LS45OTljLjI4LS4yOC43MjUtLjI4Ljk5OS0uMDA3TDguODAzIDUuOGEuNjk1LjY5NSAwIDAgMSAuMjAyLjQ5Ni42OTUuNjk1IDAgMCAxLS4yMDIuNDk3bC00LjU5NSA0LjU5NWEuNzA0LjcwNCAwIDAgMS0xLS4wMDcuNzEuNzEgMCAwIDEtLjAwNi0uOTk5bDQuMDg2LTQuMDg2eiIvPjwvc3ZnPg==');
    background-repeat: no-repeat;
    background-size: 10px;
    background-position: 50%;
  }

  .ui-datepicker-header a>span {
    display: none;
  }

  .ui-datepicker-title {
    text-align: center;
    line-height: 2rem;
    margin-bottom: 0.25rem;
    font-size: 0.875rem;
    font-weight: 500;
  }

  .ui-datepicker-week-col {
    color: #78909C;
    font-weight: 400;
    font-size: 0.75rem;
  }

  #ui-datepicker-div {
    top: 100px !important;
  }

  /* Hide scrollbar for Chrome, Safari and Opera */
  .contacts-container::-webkit-scrollbar {
    display: none;
  }

  /* Hide scrollbar for IE, Edge and Firefox */
  .contacts-container {
    -ms-overflow-style: none;
    /* IE and Edge */
    scrollbar-width: none;
    /* Firefox */
    height: 125px;
    overflow-y: auto;
    scroll-snap-type: y mandatory;
  }

  .contacts {
    scroll-snap-align: start;
  }
</style>

{% endblock %} {% block content %}


<div class="row container-fluid">
  <div class="cnav-item fs-6 col-1">
    <a class="btn btn-primary fs-6 " href="/council-detail/{{prev.id}}"><svg xmlns="http://www.w3.org/2000/svg"
        width="20" height="20" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
        <path fill-rule="evenodd"
          d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
      </svg></a>
  </div>
  <div class="cnav-item fs-6 col-10">
    <span class="col"> <b>Funding Route</b> - </span> {{ council.name }}
  </div>
  <div class="cnav-item fs-6 col-1">
    <a class="btn btn-primary fs-6" href="/council-detail/{{next.id}}"><svg xmlns="http://www.w3.org/2000/svg"
        width="20" height="20" fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
        <path fill-rule="evenodd"
          d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8" />
      </svg></a>
  </div>



  <div class="container-fluid pt-4">
    {% comment %} <div class="row">
      <div class="card p-0 d-flex">
        <div class="card-body p-3 m-0">
          <div class="row">
            <div class="col-sm-4 mb-sm-0">
              <div class="card m-0">
                <div class="card-body py-3 ">
                  <a data-council-id="{{ council.id }}" href="#" class="edit-council-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" class="text-warning icon icon-tabler icon-tabler-pencil"
                      width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                      stroke-linecap="round" stroke-linejoin="round">
                      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
                      <path d="M13.5 6.5l4 4" />
                    </svg>
                  </a>
                  {% if user.admin %}
                  <a data-council-id="{{ council.id }}" href="#" class="delete-council-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" class="text-danger icon icon-tabler icon-tabler-trash"
                      width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                      stroke-linecap="round" stroke-linejoin="round">
                      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                      <path d="M4 7l16 0" />
                      <path d="M10 11l0 6" />
                      <path d="M14 11l0 6" />
                      <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" />
                      <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
                    </svg>
                  </a>
                  {% endif %}
                  <div class=" py-2">
                    <h6>
                      <b> Name : </b> {{council.name}}

                    </h6>
                    <h6><b> Telephone : </b> {{council.phone_number}}</h6>
                    <h6><b> Email: </b> {{council.email}}</h6>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-sm-4">
              <div class="card m-0">
                <div class="card-body">
                  <h6><b> Email: </b> {{council.email}}</h6>
                  <h6><b>Address</b> : {{council.address}}</h6>
                  <h6><b>Postcode</b> : {{council.postcode}}</h6>
                </div>
              </div>
            </div>

            <div class="col-sm-4">
              <div class="card m-0">
                <div class="card-body">
                  <h6><b>Local Authority</b>: {{ council.district }}</h6>
                  <h6><b>Managed by</b>: </h6>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div> {% endcomment %}
      {% for message in messages %}
      <div class="alert {{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      {% endfor %}

      <div class="card p-0">
        <div class="card-body p-3 m-0">
          <div class="row">
            <div class="col-sm-6 mb-3 mb-sm-0">
              <div class="card m-0">
                <div class="card-body m-0">
                  <h6>
                    <b>Next Action</b>: {% with latest_action=council.get_created_at_council_action_history.first %}
                    {{latest_action.date_time }} {% endwith %}
                  </h6>
                  <div class="d-grid gap-2 d-md-block mt-3">
                    <form method="post" class="col" action="{% url 'app:na_council_action_submit' council.id %}">
                      {% csrf_token %}
                      <button class="btn btn-primary" type="submit">NA</button>
                    </form>
                  </div>
                  <form id="action_submit_form" method="post" name="action_submit_form" onSubmit="DoSubmit();"
                    action="{% url 'app:council_action_submit' council.id %}">
                    {% csrf_token %}
                    <div class="form-floating">
                      <textarea class="form-control mt-3" placeholder="Leave a comment here" id="floatingTextarea2"
                        style="height: 100px" name="text"></textarea>
                      <label for="floatingTextarea2">Comments</label>
                    </div>

                    <!-- Button trigger modal -->

                    <button type="button" class="btn btn-primary my-3" data-bs-toggle="modal"
                      data-bs-target="#staticBackdrop1">
                      Submit
                    </button>

                    <!-- Modal -->
                    <div class="modal fade" id="staticBackdrop1" data-bs-backdrop="static" data-bs-keyboard="false"
                      tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <div class="modal-body ">
                            <div class="row">
                              <div class="form-floating col">
                                <div class="wrapper">
                                  <p for="date_field" style="font-weight: 600; color: #2A3547">Date</p>
                                  <label class="label" for="date_field">
                                    <input type="text" class="input date cadate" id="date_field" name="date_field"
                                      autocomplete="off">
                                  </label>
                                </div>
                              </div>

                              <div class="mb-0 col">
                                <div class="wrapper">
                                  <p for="time_field" class="mb-3" style="font-weight: 600; color: #2A3547">Time</p>
                                  <input class="time form-control" id="time_field" type="text" data-precision="5"
                                    placeholder="Pick date & time" name='time_field' />
                                </div>
                              </div>

                            </div>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                              Close
                            </button>
                            <button class="btn btn-primary" type="submit">
                              Submit
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </form>
                  <h6>History</h6>
                  <div class="card p-0 m-0">
                    <div class="card-body p-3 m-0" style="height: 150px; overflow-y: auto">
                      <ul>
                        {% for key,value in history.items %}
                        <li><b>{{ key }}</b></li>
                        <ul class="ps-3">
                          {% for v in value %}
                          <li><b>{{ v.0 }}</b> - {{ v.1 }} </li>
                          {% endfor %}
                        </ul>
                        {% endfor %}
                      </ul>
                    </div>
                  </div>
                  <h6 class="mt-3">Key Events</h6>
                  <div class="card p-0 m-0">
                    <div class="card-body p-3 m-0" style="height: 150px; overflow-y: auto">
                      <b>{{ council.created_at }}</b> Funding Route Added by {{ council.agent.first_name }} {{
                      council.agent.last_name }}
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-sm-6">
              <div class="card m-0">
                <div class="card-body">
                  <div class="d-grid gap-2 d-md-block">
                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-primary position-relative mb-3" style="right:-70%"
                      data-bs-toggle="modal" data-bs-target="#fundingroute">
                      <i class="bi bi-plus-lg"></i> Funding Route
                    </button>

                    <!-- Modal -->
                    <div class="modal fade" id="fundingroute" data-bs-backdrop="static" data-bs-keyboard="false"
                      tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h1 class="modal-title fs-5" id="staticBackdropLabel">Select Funding Route</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <form method='post' action="/add_council_funding_route/{{ council.id }}">
                            {% csrf_token %}
                            <div class="modal-body">
                              <select class="form-select" aria-label="Default select example" name="route">
                                {% for route in routes %}
                                <option value="{{ route.id }}">{{ route.name }}</option>
                                {% endfor %}
                              </select>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                              <button type="submit" class="btn btn-primary">Submit</button>
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="card p-0 m-0">
                    <div class="card-body p-3 m-0" style="height: 390px; overflow-y: auto">

                      {% for route in c_routes %}

                       <div class="col-sm-4 mt-3" style="width: 100%">
                        <div class="card m-0 ">
                          <div class="card-body row">
                            <div class="col-10">
                            <h6><b>Name : </b> {{route.name}}</h6>
                            <h6><b>Email</b> : {{route.email}}</h6>
                            <h6><b>Telephone</b> : {{route.telephone}}</h6>
                            </div>
                            <div class="col-1">
                              <form action="/{{ route.id }}/stages">
                              <button type="submit" class="position-relative btn btn-secondary" style="right: 15px;" data-bs-dismiss="modal"> Stage </button>
                              </form>
                            </div>
                          </div>
                        </div>
                      </div> 
                      {% endfor %}

                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>


  {% endblock %} {% block js %}

  <script scr="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

  <script src="{% static 'node_modules/jquery-clock-timepicker/jquery-clock-timepicker.min.js' %}"></script>
  <script>


    function DoSubmit() {
      document.action_submit_form.date_field.value = document.action_submit_form.date_field.value.split("-").reverse().join("-");
      return confirm(date);
    }


    document.addEventListener("DOMContentLoaded", function () {
      const editButtons = document.querySelectorAll(".edit-council-btn");
      editButtons.forEach((button) => {
        button.addEventListener("click", function (event) {
          event.preventDefault();
          const councilId = button.getAttribute("data-council-id");
          window.location.href = `/council?page=edit_council&id=${councilId}`;
        });
      });

      const deleteButtons = document.querySelectorAll(".delete-council-btn");
      deleteButtons.forEach((button) => {
        button.addEventListener("click", function (event) {
          event.preventDefault();
          const councilId = button.getAttribute("data-council-id");
          const confirmDelete = confirm(
            "Are you sure you want to delete this council?"
          );
          if (confirmDelete) {
            window.location.href = `/remove_council/${councilId}`;
          }
        });
      });
    });

    var currentDate = new Date();
    var londonDate = currentDate.toLocaleString('en-GB', { timeZone: 'Europe/London' });
    var formattedDate = londonDate.split(", ")[0].split("/").join("-");
    var formattedTime = londonDate.split(", ")[1].split(":");

    const dates = document.querySelectorAll(".date");
    const time = document.querySelectorAll(".time");

    $(function () {
      $("#date_field").datepicker({
        dateFormat: "dd-mm-yy"
        , duration: "fast",
        minDate: formattedDate
      });
    });


    $('.time').clockTimePicker({
      duration: true,
      durationNegative: false,
      alwaysSelectHoursFirst: true,
      colors: {
        buttonTextColor: 'black',
        clockFaceColor: '#F1F1F1',
        clockInnerCircleTextColor: '#000',
        clockInnerCircleUnselectableTextColor: '#000',

      },
      precision: 5,
      i18n: {
        cancelButton: 'Cancle',
      },
    });

    dates.forEach((date) => {
      date.value = formattedDate;
      console.log(date.value);
    });

    time.forEach((time) => {
      time.value = `${formattedTime[0]}:${formattedTime[1]}`;
    });

    const model_btn = document.querySelectorAll('.model-btn');

    model_btn.forEach(el => {

      el.addEventListener('click', (e) => {

        let myModal = new bootstrap.Modal(

        el.nextElementSibling,
        {}
      );

      myModal.show();

        
      })
      
      

    });

    
    


    

  </script>


  {% endblock %}