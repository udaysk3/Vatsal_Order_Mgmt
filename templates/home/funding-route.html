{% extends "base.html" %} {% load static %} 
{% block css %}

  <style>

    svg{
      cursor: pointer;
    }
    @import url('https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;500;700&display=swap');

.container{
    text-align: center;
    width: 100%;
    max-width: 500px;
    min-height: 435px;
    margin: auto;
    background-color: white;
    border-radius: 16px;
    box-shadow: rgba(255, 255, 255, 0.1) 0px 1px 1px 0px inset, rgba(50, 50, 93, 0.25) 0px 50px 100px -20px, rgba(0, 0, 0, 0.3) 0px 30px 60px -30px;
}

.header-section{
    padding: 25px 0px;
}
.header-section h1{
    font-weight: 500;
    font-size: 1.7rem;
    text-transform: uppercase;
    color: #707EA0;
    margin: 0px;
    margin-bottom: 8px;
}
.header-section p{
    margin: 5px;
    font-size: 0.95rem;
    color: #707EA0;
}

.drop-section{
    min-height: 250px;
    border: 1px dashed #A8B3E3;
    background-image: linear-gradient(180deg, white, #F1F6FF);
    margin: 5px 35px 35px 35px;
    border-radius: 12px;
    position: relative;
}
.drop-section div.col:first-child{
    opacity: 1;
    visibility: visible;
    transition-duration: 0.2s;
    transform: scale(1);
    width: 200px;
    margin: auto;
}
.drop-section div.col:last-child{
    font-size: 40px;
    font-weight: 700;
    color: #c0cae1;
    position: absolute;
    top: 0px;
    bottom: 0px;
    left: 0px;
    right: 0px;
    margin: auto;
    width: 200px;
    height: 55px;
    pointer-events: none;
    opacity: 0;
    visibility: hidden;
    transform: scale(0.6);
    transition-duration: 0.2s;
}
/* we will use "drag-over-effect" class in js */
.drag-over-effect div.col:first-child{
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transform: scale(1.1);
}
.drag-over-effect div.col:last-child{
    opacity: 1;
    visibility: visible;
    transform: scale(1);
}
.drop-section .cloud-icon{
    margin-top: 25px;
    margin-bottom: 20px;
}
.drop-section span,
.drop-section button{
    display: block;
    margin: auto;
    color: #707EA0;
    margin-bottom: 10px;
}
.drop-section button{
    color: white;
    background-color: #5874C6;
    border: none;
    outline: none;
    padding: 7px 20px;
    border-radius: 8px;
    margin-top: 20px;
    cursor: pointer;
    box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px, rgba(0, 0, 0, 0.3) 0px 8px 16px -8px;
}
.drop-section input{
    display: none;
}

.list-section{
    display: none;
    text-align: left;
    margin: 0px 35px;
    padding-bottom: 20px;
}
.list-section .list-title{
    font-size: 0.95rem;
    color: #707EA0;
}
.list-section li{
    display: flex;
    margin: 15px 0px;
    padding-top: 4px;
    padding-bottom: 2px;
    border-radius: 8px;
    transition-duration: 0.2s;
}
.list-section li:hover{
    box-shadow: #E3EAF9 0px 0px 4px 0px, #E3EAF9 0px 12px 16px 0px;
}
.list-section li .col{
    flex: .1;
}
.list-section li .col:nth-child(1){
    flex: .15;
    text-align: center;
}
.list-section li .col:nth-child(2){
    flex: .75;
    text-align: left;
    font-size: 0.9rem;
    color: #3e4046;
    padding: 8px 10px;
}
.list-section li .col:nth-child(2) div.name{
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    max-width: 250px;
    display: inline-block;
}
.list-section li .col .file-name span{
    color: #707EA0;
    float: right;
}
.list-section li .file-progress{
    width: 100%;
    height: 5px;
    margin-top: 8px;
    border-radius: 8px;
    background-color: #dee6fd;
}
.list-section li .file-progress span{
    display: block;
    width: 0%;
    height: 100%;
    border-radius: 8px;
    background-image: linear-gradient(120deg, #6b99fd, #9385ff);
    transition-duration: 0.4s;
}
.list-section li .col .file-size{
    font-size: 0.75rem;
    margin-top: 3px;
    color: #707EA0;
}
.list-section li .col svg.cross,
.list-section li .col svg.tick{
    fill: #8694d2;
    background-color: #dee6fd;
    position: relative;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    border-radius: 50%;
}
.list-section li .col svg.tick{
    fill: #50a156;
    background-color: transparent;
}
.list-section li.complete span,
.list-section li.complete .file-progress,
.list-section li.complete svg.cross{
    display: none;
}
.list-section li.in-prog .file-size,
.list-section li.in-prog svg.tick{
    display: none;
}

  </style>

{% endblock %}
{% block search %}

<input
  class="form-control me-2"
  type="search"
  placeholder="Search"
  aria-label="Search"
  id="myInput"
/>

{% endblock %} {% block content %}

<div class="container-fluid" style="max-width: 1500px">
  <!-- Row 1 -->
  <div class="row">
    <div class="col-lg-12 d-flex align-items-strech w-100">
      <div class="card w-100">
        <div class="card-body">
          {% for message in messages %}
          <div
            class="alert {{ message.tags }} alert-dismissible fade show"
            role="alert"
          >
            {{ message }}
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
              aria-label="Close"
            ></button>
          </div>
          {% endfor %}
          <div
            class="d-sm-flex d-block align-items-center justify-content-between mb-9"
          >
            <div class="mb-3 mb-sm-0">
              <a href="{% url 'app:funding_route' %}">
                <h5
                  class="card-title fw-semibold text-primary text-decoration-underline"
                >
                  Funding Route
                </h5></a
              >
            </div>
            <div class="mb-3 mb-sm-0">
              <!-- Button trigger modal -->
              <button
                type="button"
                class="btn btn-primary position-relative mb-3"
                data-bs-toggle="modal"
                data-bs-target="#fundingroute"
              >
                <i class="bi bi-plus-lg"></i> Funding Route
              </button>

              <!-- Modal -->
              <div
                class="modal fade"
                id="fundingroute"
                data-bs-backdrop="static"
                data-bs-keyboard="false"
                tabindex="-1"
                aria-labelledby="staticBackdropLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h1 class="modal-title fs-5" id="staticBackdropLabel">
                        Add Funding Route
                      </h1>
                      <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                      ></button>
                    </div>
                    <form
                      method="post"
                      action="/add_funding_route"
                      enctype="multipart/form-data"
                    >
                      {% csrf_token %}
                      <div class="modal-body">
                        <div class="mb-3">
                          <label for="name" class="form-label">Name of Financial Route</label>
                          <input
                            type="text"
                            class="form-control"
                            id="name"
                            name="name"
                          />
                        </div>
                        <div class="mb-3">
                          <label for="description" class="form-label"
                            >Description</label
                          >
                          <textarea class="form-control" name="description" id="description" rows="3"></textarea>
                        </div>
                        {% comment %} <div class="mb-3">
                          <label for="managedby" class="form-label"
                            >Managed By</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="managedby"
                            name="managed_by"
                          />
                        </div>
                        <div class="mb-3">
                          <label for="maincontact" class="form-label"
                            >Main Contact</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="maincontact"
                            name="main_contact"
                          />
                        </div>
                        <div class="mb-3">
                          <label for="email" class="form-label">email</label>
                          <input
                            type="email"
                            class="form-control"
                            id="email"
                            name="email"
                          />
                        </div>
                        <div class="mb-3">
                          <label for="telephone" class="form-label"
                            >Telephone</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="telephone"
                            name="telephone"
                          />
                        </div> {% endcomment %}
                        
                        <div class="mb-3">
                          <label for="formFile" class="form-label">Financial Route Documentation</label>
                          {% comment %} <input class="form-control" type="file" id="formFile" name="document" accept="application/pdf" multiple> {% endcomment %}
                          <div class="container">
                            <div class="header-section">
                                <h1>Upload Files</h1>
                                <p>PDF files are only allowed.</p>
                            </div>
                            <div class="drop-section">
                                <div class="col">
                                    <div class="cloud-icon">
                                        <img width="100px" src="{% static "assets/img/pdf.png" %}" alt="cloud">
                                        
                                    </div>
                                    <span>Drag & Drop your files here</span>
                                    <span>OR</span>
                                    <button type="button" class="file-selector">Browse Files</button>
                                    <input type="file" id="formFile" name="document" accept="application/pdf" class="from-input file-selector-input" multiple>
                                </div>
                                <div class="col">
                                    <div class="drop-here">Drop Here</div>
                                </div>
                            </div>
                            <div class="list-section">
                                <div class="list-title">Uploaded Files</div>
                                <div class="list"></div>
                            </div>
                        </div>
                    
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-bs-dismiss="modal"
                        >
                          Close
                        </button>
                        <button type="button" id="submitBtn" class="btn btn-primary">
                          Submit
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div>
            
            <table class="table">
              <thead>
                <tr>
                  <th onclick="sortTable(0)">
                    Funding Route <span id="arrow0"></span>
                  </th>

                  <th>Description</th>
                </tr>
              </thead>

              <tbody id="myTable">
                {% if routes %} {% for route in routes %}

                <tr>
                  <td class="text-underlined" style="width: 20%"><a href="/funding_route_detail/{{ route.id }}">
                    {{ route.name }}
                  </a></td>
                  <td style="width: 20%">{{ route.description|truncatechars:80 }}</td>
                  





                  {% comment %} <td style="width: 20%">
                    
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="text-warning icon icon-tabler icon-tabler-pencil"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                        stroke="currentColor"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        data-bs-toggle="modal"
                data-bs-target="#editfundingroute{{ forloop.counter }}"
                      >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path
                          d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4"
                        />
                        <path d="M13.5 6.5l4 4" />
                      </svg>

                      <div
                class="modal fade"
                id="editfundingroute{{ forloop.counter }}"
                data-bs-backdrop="static"
                data-bs-keyboard="false"
                tabindex="-1"
                aria-labelledby="staticBackdropLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h1 class="modal-title fs-5" id="staticBackdropLabel">
                        Edit Funding Route
                      </h1>
                      <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                      ></button>
                    </div>
                    <form
                      method="post"
                      action="/edit_funding_route/{{ route.id }}"
                      enctype="multipart/form-data"
                    >
                      {% csrf_token %}
                      <div class="modal-body">
                        <div class="mb-3">
                          <label for="name" class="form-label">Name</label>
                          <input
                            type="text"
                            class="form-control"
                            id="name"
                            name="name"
                            value="{{ route.name }}"
                          />
                        </div>
                        <div class="mb-3">
                          <label for="description" class="form-label"
                            >Description</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="description"
                            name="description"
                            value="{{ route.description }}"
                          />
                        </div>
                         <div class="mb-3">
                          <label for="managedby" class="form-label"
                            >Managed By</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="managedby"
                            name="managed_by"
                            value="{{ route.managed_by }}"
                          />
                        </div>
                        <div class="mb-3">
                          <label for="maincontact" class="form-label"
                            >Main Contact</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="maincontact"
                            name="main_contact"
                            value="{{ route.main_contact }}"
                          />
                        </div>
                        <div class="mb-3">
                          <label for="email" class="form-label">email</label>
                          <input
                            type="email"
                            class="form-control"
                            id="email"
                            name="email"
                            value="{{ route.email }}"
                          />
                        </div>
                        <div class="mb-3">
                          <label for="telephone" class="form-label"
                            >Telephone</label
                          >
                          <input
                            type="text"
                            class="form-control"
                            id="telephone"
                            name="telephone"
                            value="{{ route.telephone }}"
                          />
                        </div> 
                        <div class="mb-3">
                          <label for="formFile" class="form-label">Document</label>
                          <input class="form-control" type="file" id="formFile" name="document" >
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-bs-dismiss="modal"
                        >
                          Close
                        </button>
                        <button type="submit" class="btn btn-primary">
                          Submit
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>

                  </td>





                  <td style="width: 20%">
                    <a
                      href="#"
                      class="delete-funding_route-btn"
                      data-funding_route-id="{{ route.id }}"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="text-danger icon icon-tabler icon-tabler-trash"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                        stroke="currentColor"
                        fill="none"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                        <path d="M4 7l16 0" />
                        <path d="M10 11l0 6" />
                        <path d="M14 11l0 6" />
                        <path
                          d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12"
                        />
                        <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />
                      </svg>
                    </a>
                  </td> {% endcomment %}
                </tr>
                {% endfor %} {% else %}
                <tr
                  class="text-center display-flex align-items-center justify-content-center"
                >
                  <td colspan="6" class="text-center">No Funding Route</td>
                </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock content %} {% block js %}
<script src=" {% static "js/fileupload.js" %} "></script>

<script>
  $(document).ready(function () {
    $("#myInput").on("keyup", function () {
      var value = $(this).val().toLowerCase();
      $("#myTable tr").filter(function () {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
      });
    });
  });

  function sortTable(colIndex) {
    var table,
      rows,
      switching,
      i,
      x,
      y,
      shouldSwitch,
      dir,
      switchcount = 0;
    table = document.getElementById("myTable");
    switching = true;
    dir = "asc"; // Set the sorting direction to ascending by default

    while (switching) {
      switching = false;
      rows = table.rows;
      for (i = 0; i < rows.length - 1; i++) {
        shouldSwitch = false;
        x = rows[i].getElementsByTagName("td")[colIndex];
        y = rows[i + 1].getElementsByTagName("td")[colIndex];
        if (dir === "asc") {
          if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
            shouldSwitch = true;
            break;
          }
        } else if (dir === "desc") {
          if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
            shouldSwitch = true;
            break;
          }
        }
      }
      if (shouldSwitch) {
        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
        switching = true;
        switchcount++;
      } else {
        if (switchcount === 0 && dir === "asc") {
          dir = "desc";
          switching = true;
        }
      }
    }
  }
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const cdeleteButtons = document.querySelectorAll(".delete-funding_route-btn");
    cdeleteButtons.forEach((cbutton) => {
      cbutton.addEventListener("click", function (event) {
        event.preventDefault();
        const funding_routeId = cbutton.getAttribute("data-funding_route-id");
        const confirmDelete = confirm(
          "Are you sure you want to delete this funding_route?"
        );

        if (confirmDelete) {
          window.location.href = `/remove_funding_route/${funding_routeId}`;
        }
      });
    });
  });
</script>

{% endblock js %}
